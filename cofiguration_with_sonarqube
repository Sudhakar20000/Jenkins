Jenkins project Master(10.0.0.83)
=================================

Download the plugins
manage jenkins -> plugins -> available plugins 
Eclipse Temurin installer Plugin
SonarQube Scanner for Jenkins 
OWASP Dependency-Check Plugin
Docker Compose Build Step Plugin 
Docker Pipeline
Docker plugin

Dashboard > Manage Jenkins > Tools

JDK installations 
Name:  jdk-new
Install automatically
select version
add install : install from adoptium.net

SonarQube Scanner installations 
Name SonarQube Scanner-new
Install automatically
select version

Maven installations 
Name maven-new
Install automatically
select version

Dependency-Check installations
Name DC
Install automatically
select version
add install : install from github.com

Docker installations 
Name docker-new
Install automatically
Docker version: latest

===========================================================================================================================================================================================
                                                                (sonarqube configuration with jenkins)
Now go to cli and create docker container for sonarqube  

docker run -d --name sonar -p 9000:9000 sonarqube:lts-community

acess the sonarqube url: http://10.0.0.83:9000
username: admin
password: admin

go to  Administration -> Security -> Users 
click on three dots 
name : sonar
Done
copy the tocken exmaple "squ_ebb7d7e2c78167e8374b1dabe22cb0843e2ae458"



now go to jenkins ui

Dashboard  > Manage Jenkins  > Credentials  > System >   Global credentials (unrestricted)
Add credentials
Kind:  secret text
Secret: squ_ebb7d7e2c78167e8374b1dabe22cb0843e2ae458
ID: sonar
save

docker registry credentials
New credentials
Kind: username and password
Username: sudhakar20000
password: *********
ID  docker-cred

Dashboard > Manage Jenkins >  System

SonarQube servers > SonarQube installations
Name: sonar
Server URL http://10.0.0.83:9000
Server authentication token: sonar
===========================================================================================================================================================================================
pipline to test:
Dashboard > new-pipline > Pipeline Syntax
Sample Step: withDockerRegistry set up docker endpoint
pipeline {
    agent any

    tools {
        maven 'maven-new'
        jdk 'jdk-new'
    }

    environment {
        // Corrected syntax for referencing a tool in the environment block
        SCANNER_HOME = tool 'SonarQube Scanner-new'
    }

    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/jaiswaladi246/secretsanta-generator.git'
            }
        }
        stage('Compile') {
            steps {
                sh 'mvn compile'
            }
        }
        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('SonarQube Scan') {
            steps {
                withSonarQubeEnv('sonar') {
                    sh "${SCANNER_HOME}/bin/sonar-scanner -Dsonar.projectName=santa -Dsonar.projectKey=santa -Dsonar.java.binaries=./target/classes"
                }
            }
        }
        stage('OWASP Scan') {
            steps {
                dependencyCheck additionalArguments: '--scan . ', odcInstallation: 'DC'
                dependencyCheckPublisher pattern: '**/dependency-check-report.xml'
            }
        }
        stage('Build Application') {
            steps {
                sh 'mvn package'
            }
        }
        // --- Docker Stages start here, they must be inside the 'stages' block ---
        stage('Build Docker Image') {
            steps { // Use curly braces for 'steps'
                script { // 'script' block for more complex Groovy logic
                    withDockerRegistry(credentialsId: 'docker-cred', toolName: 'docker') {
                        // Corrected 'docker build' command: -t for tag, '.' for build context
                        sh "docker build -t santa:latest ."
                    }
                }
            }
        }
        stage('Tag & Push Docker Image') {
            steps { // Use curly braces for 'steps'
                script { // 'script' block for more complex Groovy logic
                    withDockerRegistry(credentialsId: 'docker-cred', toolName: 'docker-new') {
                        // Corrected docker tag and push commands (no spaces in image names/tags)
                        sh "docker tag santa:latest sudhakar20000/santa:latest"
                        sh "docker push sudhakar20000/santa:latest"
                    }
                }
            }
        }
        stage('Deploy Application') { // Corrected quote for stage name
            steps { // Use curly braces for 'steps'
                script { // 'script' block for more complex Groovy logic
                    withDockerRegistry(credentialsId: 'docker-cred', toolName: 'docker-new')                   
                       sh "docker run -d -p 8081:8080 sudhakar20000/santa:latest"
                    }
                }
            }
        }
    } 
} 














